---
import tools from "../data/tools.json";
import BaseLayout from "../layouts/BaseLayout.astro";
import Navigation from "../components/Navigation.astro";
import { getCollection } from "astro:content";

const blogPosts = (await getCollection("blog"))
	.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
	.slice(0, 2)
	.map((post) => ({
		title: post.data.title,
		description: post.data.description,
		url: `/portfolio/blog/${post.slug}`,
		image: post.data.image || null,
		video: post.data.video || null,
	}));
---

<BaseLayout title="Portfolio | Mayke Jaspers">
	<Navigation />

	<main class="home">
		<section class="hero">
			<div class="hero-inner">
				<header class="hero-header">
					<div class="hero-logo">PORTFOLIO</div>
				</header>

				<div class="hero-content">
					<div class="hero-image-wrap">
						<img
							src="/portfolio/public/images/header.png"
							alt="Portrait of Mayke Jaspers with camera"
							class="hero-image"
						/>
					</div>
				</div>
			</div>
		</section>

		<section class="marquee-section">
			<div class="marquee">
				<div class="marquee-track">
					<span
						>CREATIVE THINKING • CREATIVE THINKING • CREATIVE
						THINKING •</span
					>
					<span
						>CREATIVE THINKING • CREATIVE THINKING • CREATIVE
						THINKING •</span
					>
					<span
						>CREATIVE THINKING • CREATIVE THINKING • CREATIVE
						THINKING •</span
					><span
						>CREATIVE THINKING • CREATIVE THINKING • CREATIVE
						THINKING •</span
					>
					<span
						>CREATIVE THINKING • CREATIVE THINKING • CREATIVE
						THINKING •</span
					>
					<span
						>CREATIVE THINKING • CREATIVE THINKING • CREATIVE
						THINKING •</span
					>
					<span
						>CREATIVE THINKING • CREATIVE THINKING • CREATIVE
						THINKING •</span
					>
				</div>
			</div>
		</section>

		<section class="about">
			<div class="about-inner">
				<div class="about-text">
					<h2 class="about-title">HELLO</h2>
					<p class="about-body">
						My name is Mayke i'am a 22 years old devine student at
						Howest Kortrijk.
					</p>
					<a href="/portfolio/about" class="about-button"
						>Want to know more</a
					>
				</div>

				<div class="about-photo-wrap">
					<img
						src="/portfolio/public/images/about.png"
						alt="Mayke Jaspers working with camera"
						class="about-photo"
					/>
				</div>
			</div>
		</section>

		<section class="discover">
			<div class="discover-header">
				<h2 class="discover-title">DISCOVER MY WORK</h2>
				<div class="video">
					<a
						href="/portfolio/projects/project-two"
						class="discover-card"
					>
						<video
							class="discover-video"
							src="/portfolio/videos/AftermovieUnderpressure.mp4"
							autoplay
							muted
							loop
							playsinline></video>
					</a>
				</div>
				<div class="discover-actions">
					<a href="/portfolio/projects" class="discover-all-btn"
						>DISCOVER ALL</a
					>
				</div>
			</div>
		</section>

		<section class="tools">
			<h2 class="tools-title">TOOLS I USE</h2>

			<div class="tools-grid">
				{
					tools.map((tool) => (
						<div class="tool-card">
							<div class="tool-icon">
								<img
									src={tool.icon}
									alt={tool.name}
									loading="lazy"
								/>
							</div>
							<div class="tool-name">{tool.name}</div>
						</div>
					))
				}
			</div>
		</section>

		<section class="blogs">
			<div class="blogs-inner">
				<div class="blogs-text">
					<h2 class="blogs-title">BLOGS</h2>
					<p class="blogs-body">
						Some thoughts, projects, and creative explorations.
					</p>
					<a href="/portfolio/blog" class="blogs-button">READ MORE</a>
				</div>

				<div class="blogs-preview">
					{
						blogPosts.map((post) => (
							<a href={post.url} class="blogs-card">
								<div class="blogs-card-thumb">
									{post.video ? (
										<video
											src={post.video}
											autoplay
											muted
											loop
											playsinline
											class="blogs-card-img"
										/>
									) : (
										<img
											src={post.image}
											alt={post.title}
											class="blogs-card-img"
										/>
									)}
								</div>
								<div class="blogs-card-info">
									<h3 class="blogs-card-title">
										{post.title}
									</h3>
									<p class="blogs-card-desc">
										{post.description}
									</p>
								</div>
							</a>
						))
					}
				</div>
			</div>
		</section>
	</main>
</BaseLayout>

<script is:inline>
	window.addEventListener("load", () => {
		const gsap = window.gsap;
		if (!gsap) return;

		gsap.from(".hero-logo", {
			y: 40,
			opacity: 0,
			duration: 0.9,
			ease: "power2.out",
		});

		gsap.from(".hero-image", {
			y: 40,
			opacity: 0,
			duration: 0.9,
			delay: 0.2,
			ease: "power2.out",
		});

		gsap.from(".discover", {
			y: 60,
			opacity: 0,
			duration: 0.9,
			delay: 0.5,
			ease: "power2.out",
		});

		const track = document.querySelector(".marquee-track");
		if (!track) return;

		const totalWidth = track.scrollWidth / 1;

		gsap.to(track, {
			x: -totalWidth,
			ease: "none",
			duration: 12,
			repeat: Infinity,
			modifiers: {
				x: (x) => {
					const val = parseFloat(x);
					const wrapped =
						((val + totalWidth) % totalWidth) - totalWidth;
					return wrapped + "px";
				},
			},
		});
	});
</script>
